<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
  <meta charset="UTF-8">
  <title>도시별 공영주차장 지도</title>

  <!-- 카카오 지도 SDK (services 필수) -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=c975d0ed07f1daa245182b32385200e1&libraries=services"></script>

  <style>

    body {
      font-family: Arial, sans-serif;
    }
    #map {
      width: 80%;
      height: 600px;
      margin-top: 10px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<div layout:fragment="content">
<body>

<h2>도시별 공영주차장 찾기</h2>

도시 입력:
<input type="text" id="city" placeholder="예: 서울 강남구">
<button onclick="searchParking()">검색</button>

<div id="map"></div>

<script>
  // 1️⃣ 지도 초기화
  var map = new kakao.maps.Map(document.getElementById('map'), {
    center: new kakao.maps.LatLng(37.5665, 126.9780), // 기본: 서울
    level: 6
  });

  var ps = new kakao.maps.services.Places();
  var markers = [];

  // 2️⃣ 검색 함수
  function searchParking() {
    var city = document.getElementById('city').value;

    if (!city) {
      alert("도시를 입력하세요");
      return;
    }

    // 기존 마커 제거
    markers.forEach(m => m.setMap(null));
    markers = [];

    // 키워드 검색: "도시명 + 공영주차장"
    ps.keywordSearch(city + " 공영주차장", function (data, status) {
      if (status !== kakao.maps.services.Status.OK) {
        alert("검색 결과가 없습니다");
        return;
      }

      var bounds = new kakao.maps.LatLngBounds();

      data.forEach(p => {
        var position = new kakao.maps.LatLng(p.y, p.x);

        var marker = new kakao.maps.Marker({
          map: map,
          position: position
        });

        markers.push(marker);
        bounds.extend(position);

        var infowindow = new kakao.maps.InfoWindow({
          content: `
            <div style="padding:5px;font-size:13px;">
              <b>${p.place_name}</b><br>
              ${p.road_address_name || p.address_name}
            </div>
          `
        });

        kakao.maps.event.addListener(marker, 'click', function () {
          infowindow.open(map, marker);
        });
      });

      // 지도 범위 재설정
      map.setBounds(bounds);
    });
  }
</script>

</body>
</div>
</html>
